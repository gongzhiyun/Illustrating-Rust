<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="760" viewBox="0 0 800 760" fill="none" xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision">
    <!-- Background -->
    <rect width="800" height="760" fill="#f8f9fa" rx="8"/>
    <!-- Title -->
    <text x="400" y="45" text-anchor="middle" fill="#333333" font-family="JetBrains Mono, monospace" font-size="24" font-weight="bold">è¿­ä»£å™¨éå†ï¼šä»åŸé›†åˆåˆ°å†…å­˜å®‰å…¨å±éšœ</text>
    
    <!-- LEFT COLUMN: Borrowing Flow -->
    <g transform="translate(40, 80)">
        <text x="110" y="20" text-anchor="middle" fill="#2196f3" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold">ä¸å¯å˜å€Ÿç”¨ (iter())</text>
        
        <!-- Original Vec (Locked) -->
        <g transform="translate(0, 40)">
            <rect x="0" y="0" width="220" height="110" rx="6" fill="#ffffff" stroke="#e0e0e0" stroke-width="1.5"/>
            <text x="110" y="25" text-anchor="middle" fill="#78909c" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold">Stack: Vec&lt;T&gt; (åŸé›†åˆ)</text>
            <line x1="0" y1="35" x2="220" y2="35" stroke="#e0e0e0" stroke-width="1"/>
            <text x="15" y="55" fill="#9e9e9e" font-family="JetBrains Mono, monospace" font-size="11">ptr: *mut T</text>
            <text x="15" y="75" fill="#9e9e9e" font-family="JetBrains Mono, monospace" font-size="11">cap: usize</text>
            <text x="15" y="95" fill="#9e9e9e" font-family="JetBrains Mono, monospace" font-size="11">len: usize</text>
            <!-- Frozen Overlay -->
            <rect x="0" y="0" width="220" height="110" rx="6" fill="#e3f2fd" fill-opacity="0.4" stroke="#2196f3" stroke-width="2" stroke-dasharray="4 2"/>
            <text x="110" y="65" text-anchor="middle" fill="#2196f3" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" transform="rotate(-15, 110, 65)">â„ï¸ FROZEN</text>
        </g>

        <!-- Arrow from Vec to Iter -->
        <path d="M 110 155 L 110 185" stroke="#2196f3" stroke-width="2" marker-end="url(#arrow-blue-down)"/>
        <text x="120" y="175" fill="#2196f3" font-family="JetBrains Mono, monospace" font-size="10">ç”Ÿæˆå€Ÿç”¨è¿­ä»£å™¨</text>

        <!-- Iter Stack Frame -->
        <g transform="translate(0, 200)">
            <rect x="0" y="0" width="220" height="150" rx="6" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
            <text x="110" y="25" text-anchor="middle" fill="#2196f3" font-family="JetBrains Mono, monospace" font-size="13" font-weight="bold">Stack: Iter&lt;'a, T&gt;</text>
            <line x1="0" y1="35" x2="220" y2="35" stroke="#2196f3" stroke-width="1"/>
            <!-- ptr field -->
            <rect x="10" y="45" width="200" height="25" rx="2" fill="#ffffff" fill-opacity="0.5"/>
            <text x="20" y="62" fill="#333333" font-family="JetBrains Mono, monospace" font-size="11">ptr: *const T</text>
            <text x="205" y="62" text-anchor="end" fill="#78909c" font-family="JetBrains Mono, monospace" font-size="10">+0</text>
            <!-- end field -->
            <rect x="10" y="75" width="200" height="25" rx="2" fill="#ffffff" fill-opacity="0.5"/>
            <text x="20" y="92" fill="#333333" font-family="JetBrains Mono, monospace" font-size="11">end: *const T</text>
            <text x="205" y="92" text-anchor="end" fill="#78909c" font-family="JetBrains Mono, monospace" font-size="10">+8</text>
            <!-- PhantomData -->
            <rect x="10" y="105" width="200" height="35" rx="2" fill="#f5f5f5" stroke="#e0e0e0" stroke-dasharray="2 2"/>
            <text x="110" y="120" text-anchor="middle" fill="#9e9e9e" font-family="JetBrains Mono, monospace" font-size="10">PhantomData&lt;&amp;'a T&gt;</text>
            <text x="110" y="133" text-anchor="middle" fill="#bdbdbd" font-family="JetBrains Mono, monospace" font-size="9">(ç”Ÿå‘½å‘¨æœŸç»‘å®š)</text>
        </g>
    </g>

    <!-- RIGHT COLUMN: Ownership Flow -->
    <g transform="translate(540, 80)">
        <text x="110" y="20" text-anchor="middle" fill="#9c27b0" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold">æ‰€æœ‰æƒè½¬ç§» (into_iter())</text>
        
        <!-- Original Vec (Moved) -->
        <g transform="translate(0, 40)">
            <rect x="0" y="0" width="220" height="110" rx="6" fill="#ffffff" stroke="#e0e0e0" stroke-width="1.5"/>
            <text x="110" y="25" text-anchor="middle" fill="#bdbdbd" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold">Stack: Vec&lt;T&gt; (åŸå˜é‡)</text>
            <line x1="0" y1="35" x2="220" y2="35" stroke="#e0e0e0" stroke-width="1"/>
            <text x="15" y="55" fill="#bdbdbd" font-family="JetBrains Mono, monospace" font-size="11" text-decoration="line-through">ptr: Unique&lt;T&gt;</text>
            <text x="15" y="75" fill="#bdbdbd" font-family="JetBrains Mono, monospace" font-size="11" text-decoration="line-through">cap: usize</text>
            <text x="15" y="95" fill="#bdbdbd" font-family="JetBrains Mono, monospace" font-size="11" text-decoration="line-through">len: usize</text>
            <!-- Invalidated Overlay -->
            <line x1="10" y1="10" x2="210" y2="100" stroke="#ef5350" stroke-width="2" stroke-opacity="0.5"/>
            <line x1="210" y1="10" x2="10" y2="100" stroke="#ef5350" stroke-width="2" stroke-opacity="0.5"/>
            <text x="110" y="65" text-anchor="middle" fill="#ef5350" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold">ğŸš« MOVED</text>
        </g>

        <!-- Arrow from Vec to IntoIter -->
        <path d="M 110 155 L 110 185" stroke="#9c27b0" stroke-width="2" marker-end="url(#arrow-purple-down)"/>
        <text x="120" y="175" fill="#9c27b0" font-family="JetBrains Mono, monospace" font-size="10">æ¥ç®¡æ‰€æœ‰æƒ</text>

        <!-- IntoIter Stack Frame -->
        <g transform="translate(0, 200)">
            <rect x="0" y="0" width="220" height="240" rx="6" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2"/>
            <text x="110" y="25" text-anchor="middle" fill="#9c27b0" font-family="JetBrains Mono, monospace" font-size="13" font-weight="bold">Stack: IntoIter&lt;T&gt;</text>
            <line x1="0" y1="35" x2="220" y2="35" stroke="#9c27b0" stroke-width="1"/>
            <!-- Iter Pointers -->
            <rect x="10" y="45" width="200" height="25" rx="2" fill="#ffffff" fill-opacity="0.5"/>
            <text x="20" y="62" fill="#333333" font-family="JetBrains Mono, monospace" font-size="11">ptr: *const T</text>
            <text x="205" y="62" text-anchor="end" fill="#78909c" font-family="JetBrains Mono, monospace" font-size="10">+24</text>
            <rect x="10" y="75" width="200" height="25" rx="2" fill="#ffffff" fill-opacity="0.5"/>
            <text x="20" y="92" fill="#333333" font-family="JetBrains Mono, monospace" font-size="11">end: *const T</text>
            <text x="205" y="92" text-anchor="end" fill="#78909c" font-family="JetBrains Mono, monospace" font-size="10">+32</text>
            <!-- RawVec Section -->
            <rect x="5" y="105" width="210" height="85" rx="4" fill="#ffffff" fill-opacity="0.3" stroke="#9c27b0" stroke-width="1" stroke-dasharray="2 2"/>
            <text x="110" y="120" text-anchor="middle" fill="#9c27b0" font-family="JetBrains Mono, monospace" font-size="10" font-weight="bold">buf: RawVec&lt;T&gt;</text>
            <text x="15" y="140" fill="#333333" font-family="JetBrains Mono, monospace" font-size="11">  ptr: Unique&lt;T&gt;</text>
            <text x="15" y="160" fill="#333333" font-family="JetBrains Mono, monospace" font-size="11">  cap: usize</text>
            <text x="15" y="180" fill="#333333" font-family="JetBrains Mono, monospace" font-size="11">  alloc: Global</text>
            <!-- PhantomData -->
            <rect x="10" y="195" width="200" height="35" rx="2" fill="#f5f5f5" stroke="#e0e0e0" stroke-dasharray="2 2"/>
            <text x="110" y="210" text-anchor="middle" fill="#9e9e9e" font-family="JetBrains Mono, monospace" font-size="10">PhantomData&lt;T&gt;</text>
            <text x="110" y="223" text-anchor="middle" fill="#bdbdbd" font-family="JetBrains Mono, monospace" font-size="9">(æ‰€æœ‰æƒæ‰€æœ‰è€…)</text>
        </g>
    </g>

    <!-- CENTRAL HEAP AREA -->
    <g transform="translate(260, 600)">
        <text x="140" y="-15" text-anchor="middle" fill="#4caf50" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold">Heap: æ•°æ®å†…å­˜å¸ƒå±€</text>
        <g transform="translate(0, 10)">
            <rect x="0" y="0" width="55" height="45" fill="#eeeeee" stroke="#bdbdbd" stroke-width="1"/>
            <text x="27.5" y="28" text-anchor="middle" fill="#9e9e9e" font-family="JetBrains Mono, monospace" font-size="12">T0</text>
            <rect x="55" y="0" width="55" height="45" fill="#eeeeee" stroke="#bdbdbd" stroke-width="1"/>
            <text x="82.5" y="28" text-anchor="middle" fill="#9e9e9e" font-family="JetBrains Mono, monospace" font-size="12">T1</text>
            <rect x="110" y="0" width="60" height="45" fill="#fff8e1" stroke="#ff9800" stroke-width="2.5"/>
            <text x="140" y="28" text-anchor="middle" fill="#333333" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold">T2</text>
            <rect x="170" y="0" width="55" height="45" fill="#e8f5e9" stroke="#4caf50" stroke-width="1"/>
            <text x="197.5" y="28" text-anchor="middle" fill="#333333" font-family="JetBrains Mono, monospace" font-size="12">T3</text>
            <rect x="225" y="0" width="55" height="45" fill="#e8f5e9" stroke="#4caf50" stroke-width="1"/>
            <text x="252.5" y="28" text-anchor="middle" fill="#333333" font-family="JetBrains Mono, monospace" font-size="12">T4</text>
            <path d="M 140 55 L 140 85" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow-orange)"/>
            <text x="140" y="105" text-anchor="middle" fill="#ff9800" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold">next() æŒ‡å‘</text>
        </g>
    </g>

    <!-- POINTER PATHS -->
    <!-- Iter.ptr to Heap: (40+210, 80+200+45+12.5) = (250, 337.5) -->
    <circle cx="250" cy="337.5" r="3" fill="#2196f3"/>
    <path d="M 250 337.5 C 320 337.5, 340 540, 370 605" stroke="#2196f3" stroke-width="2" stroke-dasharray="5 3" fill="none" marker-end="url(#arrow-blue)"/>
    <text x="315" y="480" text-anchor="end" fill="#2196f3" font-family="JetBrains Mono, monospace" font-size="11">ptr å€Ÿç”¨æ•°æ®</text>

    <!-- IntoIter.ptr to Heap: (540+10, 80+200+45+12.5) = (550, 337.5) -->
    <circle cx="550" cy="337.5" r="3" fill="#9c27b0"/>
    <path d="M 550 337.5 C 480 337.5, 460 540, 430 605" stroke="#9c27b0" stroke-width="2" fill="none" marker-end="url(#arrow-purple)"/>
    <text x="485" y="480" text-anchor="start" fill="#9c27b0" font-family="JetBrains Mono, monospace" font-size="11">ptr æ¶ˆè´¹æ•°æ®</text>

    <!-- DEFINITIONS -->
    <defs>
        <marker id="arrow-blue-down" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
            <path d="M0,0 L8,3 L0,6 Z" fill="#2196f3" />
        </marker>
        <marker id="arrow-purple-down" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
            <path d="M0,0 L8,3 L0,6 Z" fill="#9c27b0" />
        </marker>
        <marker id="arrow-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <path d="M0,0 L10,3.5 L0,7 Z" fill="#ff9800" />
        </marker>
        <marker id="arrow-blue" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
            <path d="M0,0 L8,3 L0,6 Z" fill="#2196f3" />
        </marker>
        <marker id="arrow-purple" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
            <path d="M0,0 L8,3 L0,6 Z" fill="#9c27b0" />
        </marker>
    </defs>
</svg>