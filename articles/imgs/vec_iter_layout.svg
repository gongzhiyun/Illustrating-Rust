<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 500" shape-rendering="geometricPrecision" text-rendering="geometricPrecision">
    <rect width="800" height="500" fill="#f8f9fa" />
    
    <!-- Title -->
    <text x="400" y="40" font-family="JetBrains Mono, monospace" font-size="22" font-weight="bold" text-anchor="middle" fill="#333333">Vec::iter() 内存布局：从动态数组到切片迭代器</text>
    
    <!-- Legend -->
    <g transform="translate(620, 400)">
        <rect width="160" height="80" fill="#ffffff" stroke="#e0e0e0" rx="4" />
        <rect x="10" y="15" width="20" height="10" fill="#e3f2fd" stroke="#2196f3" />
        <text x="40" y="24" font-family="JetBrains Mono, monospace" font-size="12" fill="#78909c">Stack (栈)</text>
        <rect x="10" y="40" width="20" height="10" fill="#e8f5e9" stroke="#4caf50" />
        <text x="40" y="49" font-family="JetBrains Mono, monospace" font-size="12" fill="#78909c">Heap (堆)</text>
        <rect x="10" y="65" width="20" height="10" fill="#fff8e1" stroke="#ff9800" />
        <text x="40" y="74" font-family="JetBrains Mono, monospace" font-size="12" fill="#78909c">Pointer (指针)</text>
    </g>

    <!-- Heap Memory Section -->
    <text x="400" y="100" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold" text-anchor="middle" fill="#78909c">Heap (堆内存数据)</text>
    <g transform="translate(200, 120)">
        <rect x="0" y="0" width="400" height="60" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="4" />
        <!-- Elements -->
        <rect x="0" y="0" width="100" height="60" fill="none" stroke="#4caf50" stroke-dasharray="2" />
        <text x="50" y="35" font-family="JetBrains Mono, monospace" font-size="14" text-anchor="middle" fill="#4caf50">T [0]</text>
        
        <rect x="100" y="0" width="100" height="60" fill="none" stroke="#4caf50" stroke-dasharray="2" />
        <text x="150" y="35" font-family="JetBrains Mono, monospace" font-size="14" text-anchor="middle" fill="#4caf50">T [1]</text>
        
        <rect x="200" y="0" width="100" height="60" fill="none" stroke="#4caf50" stroke-dasharray="2" />
        <text x="250" y="35" font-family="JetBrains Mono, monospace" font-size="14" text-anchor="middle" fill="#4caf50">T [2]</text>
        
        <rect x="300" y="0" width="100" height="60" fill="#f5f5f5" stroke="#bdbdbd" stroke-dasharray="4" />
        <text x="350" y="35" font-family="JetBrains Mono, monospace" font-size="12" text-anchor="middle" fill="#9e9e9e">Uninit (Cap)</text>
    </g>

    <!-- Stack Section -->
    <g transform="translate(100, 280)">
        <text x="80" y="-45" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold" text-anchor="middle" fill="#78909c">Stack (栈内存)</text>
        
        <!-- Vec Struct -->
        <g transform="translate(0, 0)">
            <!-- Type Label Box -->
            <rect x="30" y="-22" width="100" height="18" rx="4" fill="#2196f3" />
            <text x="80" y="-9" font-family="JetBrains Mono, monospace" font-size="11" font-weight="bold" fill="#fff" text-anchor="middle">Vec&lt;T&gt;</text>
            
            <rect x="0" y="0" width="160" height="100" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="4" />
            
            <text x="10" y="25" font-family="JetBrains Mono, monospace" font-size="12" fill="#2196f3">ptr: *mut T</text>
            <text x="10" y="55" font-family="JetBrains Mono, monospace" font-size="12" fill="#2196f3">cap: 4</text>
            <text x="10" y="85" font-family="JetBrains Mono, monospace" font-size="12" fill="#2196f3">len: 3</text>
            
            <!-- Pointer to Heap -->
            <path d="M160,25 Q300,25 200,90" fill="none" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow)" />
        </g>

        <!-- Frozen Badge -->
        <rect x="-10" y="-35" width="180" height="155" fill="none" stroke="#ef5350" stroke-width="2" stroke-dasharray="5" rx="8" />
        <text x="80" y="145" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" text-anchor="middle" fill="#ef5350">BORROWED &amp; FROZEN</text>

        <!-- Iter Struct -->
        <g transform="translate(440, 0)">
            <!-- Type Label Box -->
            <rect x="30" y="-22" width="100" height="18" rx="4" fill="#ff9800" />
            <text x="80" y="-9" font-family="JetBrains Mono, monospace" font-size="11" font-weight="bold" fill="#fff" text-anchor="middle">Iter&lt;'a, T&gt;</text>
            
            <rect x="0" y="0" width="160" height="70" fill="#fff8e1" stroke="#ff9800" stroke-width="2" rx="4" />
            
            <text x="10" y="25" font-family="JetBrains Mono, monospace" font-size="12" fill="#ff9800">ptr: *const T</text>
            <text x="10" y="55" font-family="JetBrains Mono, monospace" font-size="12" fill="#ff9800">end: *const T</text>
            
            <!-- Pointers to Heap -->
            <!-- ptr points to start -->
            <path d="M0,25 Q-100,25 200,90" fill="none" stroke="#ff9800" stroke-width="1.5" stroke-dasharray="3" marker-end="url(#arrow)" />
            <!-- end points to len -->
            <path d="M0,55 Q-50,55 500,90" fill="none" stroke="#ff9800" stroke-width="1.5" stroke-dasharray="3" marker-end="url(#arrow)" />
        </g>
    </g>

    <!-- Definitions -->
    <defs>
        <marker id="arrow" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#ff9800" />
        </marker>
    </defs>
    
    <!-- Explanation Text -->
    <g transform="translate(100, 440)">
        <text x="0" y="0" font-family="JetBrains Mono, monospace" font-size="12" fill="#333333">1. Vec::iter() 通过解引用转换为 &amp;[T]，再转换为 Iter 结构体。</text>
        <text x="0" y="20" font-family="JetBrains Mono, monospace" font-size="12" fill="#333333">2. Iter 内部仅维护两个原始指针，实现极简。其生命周期 'a 绑定 Vec。</text>
    </g>
</svg>
