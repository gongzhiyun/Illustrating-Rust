<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="400" viewBox="0 0 800 400" fill="none" xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision">
    <!-- Background -->
    <rect width="800" height="400" rx="15" fill="#f8f9fa"/>
    
    <!-- Title -->
    <text x="400" y="40" font-family="JetBrains Mono, monospace" font-size="22" font-weight="bold" fill="#333333" text-anchor="middle">Tokio Task 内存布局 (Heap)</text>

    <!-- Heap Area -->
    <rect x="100" y="80" width="600" height="280" rx="12" fill="#e8f5e9" stroke="#4caf50" stroke-width="2"/>
    <text x="115" y="105" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#2e7d32">Heap (堆)</text>

    <!-- Task Container -->
    <rect x="150" y="120" width="500" height="200" rx="8" fill="#ffffff" stroke="#e0e0e0" stroke-width="2"/>
    
    <!-- Header Section -->
    <rect x="150" y="120" width="500" height="80" rx="8" fill="#e3f2fd" stroke="#1565c0" stroke-width="2"/>
    <text x="400" y="145" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#1565c0" text-anchor="middle">Task Header (元数据)</text>
    
    <!-- Header Details -->
    <line x1="150" y1="160" x2="650" y2="160" stroke="#1565c0" stroke-width="1"/>
    <text x="160" y="180" font-family="JetBrains Mono, monospace" font-size="11" fill="#1565c0">vtable (虚函数表)</text>
    <line x1="300" y1="160" x2="300" y2="200" stroke="#1565c0" stroke-width="1"/>
    <text x="310" y="180" font-family="JetBrains Mono, monospace" font-size="11" fill="#1565c0">state (任务状态)</text>
    <line x1="450" y1="160" x2="450" y2="200" stroke="#1565c0" stroke-width="1"/>
    <text x="460" y="180" font-family="JetBrains Mono, monospace" font-size="11" fill="#1565c0">ref_count / links</text>

    <!-- Future Section -->
    <rect x="150" y="210" width="500" height="100" rx="8" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2"/>
    <text x="400" y="235" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#6a1b9a" text-anchor="middle">Future (异步状态机)</text>
    
    <!-- Future Details (State Machine) -->
    <rect x="170" y="250" width="460" height="50" rx="4" fill="#ffffff" stroke="#ab47bc" stroke-dasharray="4 2"/>
    <text x="400" y="275" font-family="JetBrains Mono, monospace" font-size="11" fill="#6a1b9a" text-anchor="middle">enum State { Pending(Vars), Ready(Result) }</text>
    <text x="400" y="290" font-family="JetBrains Mono, monospace" font-size="9" fill="#9c27b0" text-anchor="middle">保存跨越 .await 的局部变量 (如 Duration, Handle)</text>

    <!-- Pointer from Queue -->
    <path d="M 50 200 L 140 160" stroke="#ff9800" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="30" y="220" font-family="JetBrains Mono, monospace" font-size="11" fill="#f57c00">从调度队列指向</text>

    <!-- Markers -->
    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#ff9800" />
        </marker>
    </defs>
</svg>
