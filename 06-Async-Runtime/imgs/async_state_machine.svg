<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 450" shape-rendering="geometricPrecision" text-rendering="geometricPrecision">
    <!-- Background -->
    <rect width="800" height="450" fill="#f8f9fa" />
    
    <!-- Title -->
    <text x="400" y="40" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="22" font-weight="bold" fill="#333333">Async 函数的状态机转换</text>
    
    <!-- Source Code Section -->
    <g transform="translate(50, 80)">
        <rect width="320" height="320" rx="15" fill="#ffffff" stroke="#e0e0e0" stroke-width="1" />
        <rect width="320" height="30" rx="12" fill="#f3e5f5" />
        <text x="160" y="20" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#6a1b9a">源代码 (Async Code)</text>
        
        <text x="20" y="70" font-family="JetBrains Mono, monospace" font-size="12" fill="#333333">
            <tspan x="20" dy="1.2em">async fn my_task() {</tspan>
            <tspan x="40" dy="1.5em" fill="#78909c">// 状态 1: 开始</tspan>
            <tspan x="40" dy="1.2em">let a = step_one().await;</tspan>
            <tspan x="40" dy="1.5em" fill="#78909c">// 状态 2: 等待 step_one</tspan>
            <tspan x="40" dy="1.2em">let b = step_two(a).await;</tspan>
            <tspan x="40" dy="1.5em" fill="#78909c">// 状态 3: 等待 step_two</tspan>
            <tspan x="40" dy="1.2em">println!("{}", b);</tspan>
            <tspan x="20" dy="1.5em">}</tspan>
        </text>
        
        <!-- Highlight await points -->
        <rect x="35" y="105" width="220" height="20" fill="#fff8e1" opacity="0.5" stroke="#ff9800" stroke-dasharray="4 2" />
        <rect x="35" y="145" width="220" height="20" fill="#fff8e1" opacity="0.5" stroke="#ff9800" stroke-dasharray="4 2" />
    </g>
    
    <!-- Transformation Arrow -->
    <g transform="translate(380, 220)">
        <path d="M 0 0 L 40 0" stroke="#ff9800" stroke-width="3" fill="none" marker-end="url(#arrowhead)" />
        <text x="20" y="-10" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#f57c00">编译时转换</text>
    </g>
    
    <!-- State Machine Section -->
    <g transform="translate(430, 80)">
        <rect width="320" height="320" rx="15" fill="#ffffff" stroke="#e0e0e0" stroke-width="1" />
        <rect width="320" height="30" rx="12" fill="#e3f2fd" />
        <text x="160" y="20" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#1565c0">编译器生成的结构体 (State Machine)</text>
        
        <!-- States -->
        <g transform="translate(20, 50)">
            <!-- State: Start -->
            <rect width="280" height="40" rx="8" fill="#ffffff" stroke="#4caf50" stroke-width="1.5" />
            <text x="140" y="25" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#2e7d32">State::Start</text>
            
            <!-- Arrow -->
            <path d="M 140 40 L 140 60" stroke="#e0e0e0" stroke-width="1" marker-end="url(#small-arrow)" />
            
            <!-- State: Waiting1 -->
            <g transform="translate(0, 60)">
                <rect width="280" height="60" rx="8" fill="#ffffff" stroke="#2196f3" stroke-width="1.5" />
                <text x="140" y="20" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" font-weight="bold" fill="#1565c0">State::WaitingForStepOne</text>
                <text x="140" y="40" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="10" fill="#546e7a">{ future1: StepOneFuture }</text>
            </g>
            
            <!-- Arrow -->
            <path d="M 140 120 L 140 140" stroke="#e0e0e0" stroke-width="1" marker-end="url(#small-arrow)" />
            
            <!-- State: Waiting2 -->
            <g transform="translate(0, 140)">
                <rect width="280" height="60" rx="8" fill="#ffffff" stroke="#2196f3" stroke-width="1.5" />
                <text x="140" y="20" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" font-weight="bold" fill="#1565c0">State::WaitingForStepTwo</text>
                <text x="140" y="40" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="10" fill="#546e7a">{ a: i32, future2: StepTwoFuture }</text>
            </g>
            
            <!-- Arrow -->
            <path d="M 140 200 L 140 220" stroke="#e0e0e0" stroke-width="1" marker-end="url(#small-arrow)" />
            
            <!-- State: Done -->
            <g transform="translate(0, 220)">
                <rect width="280" height="40" rx="8" fill="#ffffff" stroke="#9e9e9e" stroke-width="1.5" />
                <text x="140" y="25" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#616161">State::Done</text>
            </g>
        </g>
    </g>
    
    <!-- Markers -->
    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#ff9800" />
        </marker>
        <marker id="small-arrow" markerWidth="6" markerHeight="4" refX="0" refY="2" orient="auto">
            <polygon points="0 0, 6 2, 0 4" fill="#e0e0e0" />
        </marker>
    </defs>
</svg>
