<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="520" viewBox="0 0 800 520" xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision">
    <!-- Background Gradient -->
    <defs>
        <linearGradient id="bgGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#f8f9fa;stop-opacity:1" />
        </linearGradient>
        <filter id="dropShadow" x="-5%" y="-5%" width="110%" height="110%">
            <feGaussianBlur in="SourceAlpha" stdDeviation="3" />
            <feOffset dx="1" dy="2" result="offsetblur" />
            <feComponentTransfer>
                <feFuncA type="linear" slope="0.1" />
            </feComponentTransfer>
            <feMerge>
                <feMergeNode />
                <feMergeNode in="SourceGraphic" />
            </feMerge>
        </filter>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#ff9800" />
        </marker>
    </defs>
    
    <rect width="800" height="520" fill="url(#bgGradient)" />

    <!-- Address Axis -->
    <g transform="translate(40, 50)">
        <line x1="15" y1="0" x2="15" y2="420" stroke="#bdc3c7" stroke-width="1" stroke-dasharray="4,2" />
        <text x="0" y="10" font-family="JetBrains Mono, monospace" font-size="10" fill="#95a5a6" text-anchor="end">High</text>
        <text x="0" y="420" font-family="JetBrains Mono, monospace" font-size="10" fill="#95a5a6" text-anchor="end">Low</text>
        
        <!-- Stack Offset Labels -->
        <text x="-5" y="65" font-family="JetBrains Mono, monospace" font-size="10" fill="#95a5a6" text-anchor="end">+0</text>
        <text x="-5" y="115" font-family="JetBrains Mono, monospace" font-size="10" fill="#95a5a6" text-anchor="end">+8</text>
        <text x="-5" y="165" font-family="JetBrains Mono, monospace" font-size="10" fill="#95a5a6" text-anchor="end">+16</text>
        <text x="-5" y="245" font-family="JetBrains Mono, monospace" font-size="10" fill="#95a5a6" text-anchor="end">+24</text>
        <text x="-5" y="295" font-family="JetBrains Mono, monospace" font-size="10" fill="#95a5a6" text-anchor="end">+32</text>
    </g>

    <!-- 1. Vec<T> Stack (Original) -->
    <g transform="translate(80, 85)">
        <text x="0" y="-15" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#333">Vec&lt;T&gt; (Owner)</text>
        <rect width="220" height="150" rx="4" fill="white" filter="url(#dropShadow)" stroke="#ecf0f1" />
        
        <!-- ptr -->
        <rect width="220" height="50" fill="#fffde7" stroke="#fbc02d" stroke-width="2" />
        <text x="15" y="30" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#455a64">ptr</text>
        <text x="205" y="30" font-family="JetBrains Mono, monospace" font-size="11" font-weight="bold" fill="#fbc02d" text-anchor="end">0x1000</text>
        
        <!-- cap -->
        <rect y="50" width="220" height="50" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" />
        <text x="15" y="80" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#455a64">cap</text>
        <text x="205" y="80" font-family="JetBrains Mono, monospace" font-size="13" font-weight="bold" fill="#7b1fa2" text-anchor="end">4</text>
        
        <!-- len -->
        <rect y="100" width="220" height="50" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" />
        <text x="15" y="130" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#455a64">len</text>
        <text x="205" y="130" font-family="JetBrains Mono, monospace" font-size="13" font-weight="bold" fill="#2e7d32" text-anchor="end">3</text>
    </g>

    <!-- 2. &[T] Slice Stack (Fat Pointer) -->
    <g transform="translate(80, 265)">
        <text x="0" y="-15" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#333">&amp;[T] (Slice/Borrow)</text>
        <rect width="220" height="100" rx="4" fill="white" filter="url(#dropShadow)" stroke="#ecf0f1" />
        
        <!-- ptr -->
        <rect width="220" height="50" fill="#fffde7" stroke="#fbc02d" stroke-width="2" />
        <text x="15" y="30" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#455a64">ptr</text>
        <text x="205" y="30" font-family="JetBrains Mono, monospace" font-size="11" font-weight="bold" fill="#fbc02d" text-anchor="end">0x1008</text>
        
        <!-- len -->
        <rect y="50" width="220" height="50" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" />
        <text x="15" y="80" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#455a64">len</text>
        <text x="205" y="80" font-family="JetBrains Mono, monospace" font-size="13" font-weight="bold" fill="#2e7d32" text-anchor="end">2</text>
        
        <text x="225" y="55" font-family="JetBrains Mono, monospace" font-size="11" fill="#78909c" font-style="italic">Fat Pointer</text>
    </g>

    <!-- Heap Memory -->
    <g transform="translate(480, 85)">
        <text x="0" y="-15" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#333">Heap Memory (Continuous)</text>
        <rect width="280" height="330" rx="8" fill="white" filter="url(#dropShadow)" stroke="#ecf0f1" />
        
        <!-- Data Blocks -->
        <g transform="translate(20, 30)">
            <!-- Index 0 -->
            <rect width="240" height="60" rx="4" fill="#fff" stroke="#bdc3c7" stroke-dasharray="2,2" />
            <text x="230" y="35" font-family="JetBrains Mono, monospace" font-size="10" fill="#95a5a6" text-anchor="end">v[0] (0x1000)</text>
            <text x="120" y="35" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#bdc3c7" text-anchor="middle">A</text>
            
            <!-- Index 1 & 2 (Slice Range) -->
            <g transform="translate(0, 65)">
                <rect width="240" height="125" rx="4" fill="#f1f8e9" stroke="#4caf50" stroke-width="2" />
                
                <!-- Index 1 -->
                <rect x="5" y="5" width="230" height="55" rx="2" fill="white" stroke="#4caf50" stroke-width="1" />
                <text x="225" y="35" font-family="JetBrains Mono, monospace" font-size="10" fill="#2e7d32" text-anchor="end">v[1] (0x1008)</text>
                <text x="120" y="35" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold" fill="#2e7d32" text-anchor="middle">B</text>
                
                <!-- Index 2 -->
                <rect x="5" y="65" width="230" height="55" rx="2" fill="white" stroke="#4caf50" stroke-width="1" />
                <text x="225" y="95" font-family="JetBrains Mono, monospace" font-size="10" fill="#2e7d32" text-anchor="end">v[2] (0x1010)</text>
                <text x="120" y="95" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold" fill="#2e7d32" text-anchor="middle">C</text>
                
                <text x="-10" y="65" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#2e7d32" transform="rotate(-90, -10, 65)" text-anchor="middle">Slice Range</text>
            </g>
            
            <!-- Free Space -->
            <rect x="0" y="195" width="240" height="60" rx="4" fill="#fafafa" stroke="#dfe6e9" stroke-dasharray="4,4" />
            <text x="120" y="230" font-family="JetBrains Mono, monospace" font-size="11" fill="#b2bec3" text-anchor="middle">Free (0x1018)</text>
        </g>
    </g>

    <!-- Connections -->
    <!-- Vec -> Heap (Start) -->
    <path d="M 300,110 C 380,110 400,115 480,115" fill="none" stroke="#fbc02d" stroke-width="2" stroke-dasharray="4,2" />
    <circle cx="300" cy="110" r="3" fill="#fbc02d" />
    
    <!-- Slice -> Heap (Offset) -->
    <path d="M 300,290 C 400,290 420,185 505,185" fill="none" stroke="#ff9800" stroke-width="2.5" marker-end="url(#arrowhead)" />
    <circle cx="300" cy="290" r="4" fill="#fbc02d" />
</svg>
