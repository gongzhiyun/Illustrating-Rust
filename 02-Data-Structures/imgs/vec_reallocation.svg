<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="650" viewBox="0 0 800 650" xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision">
    <!-- Background Gradient -->
    <defs>
        <linearGradient id="bgGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#f8f9fa;stop-opacity:1" />
        </linearGradient>
        <filter id="dropShadow" x="-5%" y="-5%" width="110%" height="110%">
            <feGaussianBlur in="SourceAlpha" stdDeviation="3" />
            <feOffset dx="1" dy="2" result="offsetblur" />
            <feComponentTransfer>
                <feFuncA type="linear" slope="0.1" />
            </feComponentTransfer>
            <feMerge>
                <feMergeNode />
                <feMergeNode in="SourceGraphic" />
            </feMerge>
        </filter>
        <marker id="arrowhead-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#ff9800" />
        </marker>
        <marker id="arrowhead-gray" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#95a5a6" />
        </marker>
    </defs>
    
    <rect width="800" height="650" fill="url(#bgGradient)" />
    
    <!-- Header -->
    <text x="400" y="45" font-family="JetBrains Mono, monospace" font-size="24" font-weight="bold" text-anchor="middle" fill="#2c3e50">Vec&lt;T&gt; Reallocation</text>
    <line x1="340" y1="55" x2="460" y2="55" stroke="#ff9800" stroke-width="3" />

    <!-- Column Headers -->
    <g transform="translate(200, 110)">
        <rect x="-70" y="-30" width="140" height="30" rx="15" fill="#e3f2fd" stroke="#2196f3" stroke-width="1.5" />
        <text y="-10" font-family="JetBrains Mono, monospace" font-size="13" font-weight="bold" fill="#1976d2" text-anchor="middle">STACK</text>
    </g>
    <g transform="translate(600, 110)">
        <rect x="-70" y="-30" width="140" height="30" rx="15" fill="#e8f5e9" stroke="#4caf50" stroke-width="1.5" />
        <text y="-10" font-family="JetBrains Mono, monospace" font-size="13" font-weight="bold" fill="#2e7d32" text-anchor="middle">HEAP</text>
    </g>

    <!-- Stack Visualizer -->
    <g transform="translate(60, 140)">
        <!-- Address Axis -->
        <path d="M 15,0 L 15,450" fill="none" stroke="#bdc3c7" stroke-width="1" stroke-dasharray="4,2" />
        <text x="10" y="15" font-family="JetBrains Mono, monospace" font-size="9" fill="#95a5a6" text-anchor="end" transform="rotate(-90, 10, 15)">High</text>
        <text x="10" y="440" font-family="JetBrains Mono, monospace" font-size="9" fill="#95a5a6" text-anchor="end" transform="rotate(-90, 10, 440)">Low</text>

        <g transform="translate(40, 10)">
            <rect width="220" height="440" rx="4" fill="white" filter="url(#dropShadow)" stroke="#ecf0f1" />
            
            <!-- Vec Metadata -->
            <g transform="translate(0, 40)">
                <!-- ptr -->
                <rect width="220" height="50" fill="#fffde7" stroke="#fbc02d" stroke-width="2" />
                <text x="15" y="30" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#455a64">ptr</text>
                <text x="205" y="30" font-family="JetBrains Mono, monospace" font-size="11" font-weight="bold" fill="#fbc02d" text-anchor="end">0x1000 -> 0x2000</text>
                
                <!-- cap -->
                <rect y="50" width="220" height="50" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" />
                <text x="15" y="80" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#455a64">cap</text>
                <text x="205" y="80" font-family="JetBrains Mono, monospace" font-size="13" font-weight="bold" fill="#7b1fa2" text-anchor="end">2 -> 4</text>
                
                <!-- len -->
                <rect y="100" width="220" height="50" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" />
                <text x="15" y="130" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#455a64">len</text>
                <text x="205" y="130" font-family="JetBrains Mono, monospace" font-size="13" font-weight="bold" fill="#2e7d32" text-anchor="end">2 -> 3</text>
            </g>

            <!-- Byte Offsets -->
            <g font-family="JetBrains Mono, monospace" font-size="9" fill="#95a5a6">
                <text x="-5" y="65">+0</text>
                <text x="-5" y="115">+8</text>
                <text x="-5" y="165">+16</text>
            </g>

            <!-- Vertical Label -->
            <text x="235" y="115" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#2196f3" transform="rotate(90, 235, 115)" text-anchor="middle">Vec&lt;T&gt;</text>
            
            <rect y="190" width="220" height="250" fill="#fcfcfc" stroke="#ecf0f1" />
            <text x="110" y="315" font-family="JetBrains Mono, monospace" font-size="11" fill="#bdc3c7" text-anchor="middle">Stack Memory</text>
        </g>
    </g>

    <!-- Heap Visualizer -->
    <g transform="translate(460, 140)">
        <rect width="300" height="450" rx="8" fill="white" filter="url(#dropShadow)" stroke="#ecf0f1" />
        
        <!-- Old Allocation (Released) -->
        <g transform="translate(15, 40)">
            <text x="0" y="-10" font-family="JetBrains Mono, monospace" font-size="10" fill="#ef5350" font-weight="bold">Old: 0x1000 (Freed)</text>
            <g opacity="0.4">
                <rect width="60" height="60" rx="4" fill="#ffebee" stroke="#ef5350" stroke-width="1.5" />
                <text x="30" y="35" font-family="JetBrains Mono, monospace" font-size="14" fill="#ef5350" text-anchor="middle">A</text>
                <rect x="60" width="60" height="60" rx="4" fill="#ffebee" stroke="#ef5350" stroke-width="1.5" />
                <text x="90" y="35" font-family="JetBrains Mono, monospace" font-size="14" fill="#ef5350" text-anchor="middle">B</text>
                <!-- Cross out -->
                <line x1="0" y1="0" x2="120" y2="60" stroke="#ef5350" stroke-width="1" />
                <line x1="0" y1="60" x2="120" y2="0" stroke="#ef5350" stroke-width="1" />
            </g>
        </g>

        <!-- Bitwise Copy Arrow -->
        <path d="M 75,110 L 75,190" fill="none" stroke="#95a5a6" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#arrowhead-gray)" />
        <text x="85" y="155" font-family="JetBrains Mono, monospace" font-size="10" fill="#7f8c8d">Bitwise Copy</text>

        <!-- New Allocation -->
        <g transform="translate(15, 210)">
            <text x="0" y="-10" font-family="JetBrains Mono, monospace" font-size="10" fill="#4caf50" font-weight="bold">New: 0x2000 (cap=4)</text>
            <g>
                <rect width="60" height="60" rx="4" fill="#fff" stroke="#4caf50" stroke-width="2" />
                <text x="30" y="35" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#2e7d32" text-anchor="middle">A</text>
                
                <rect x="60" width="60" height="60" rx="4" fill="#fff" stroke="#4caf50" stroke-width="2" />
                <text x="90" y="35" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#2e7d32" text-anchor="middle">B</text>
                
                <rect x="120" width="60" height="60" rx="4" fill="#fffde7" stroke="#ff9800" stroke-width="2" />
                <text x="150" y="35" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#f57c00" text-anchor="middle">C</text>
                
                <rect x="180" width="60" height="60" rx="4" fill="#f1f8e9" stroke="#cfd8dc" stroke-dasharray="3,3" />
                <text x="210" y="35" font-family="JetBrains Mono, monospace" font-size="10" fill="#90a4ae" text-anchor="middle">Free</text>
            </g>
            
            <!-- Indicators -->
            <path d="M 0,70 L 0,78 L 180,78 L 180,70" fill="none" stroke="#4caf50" stroke-width="1.5" />
            <text x="90" y="92" font-family="JetBrains Mono, monospace" font-size="10" font-weight="bold" fill="#4caf50" text-anchor="middle">len=3</text>
            
            <path d="M 0,110 L 0,118 L 240,118 L 240,110" fill="none" stroke="#9c27b0" stroke-width="1.5" />
            <text x="120" y="132" font-family="JetBrains Mono, monospace" font-size="10" font-weight="bold" fill="#9c27b0" text-anchor="middle">cap=4</text>
        </g>

        <!-- Process Notes -->
        <g transform="translate(15, 380)" font-family="JetBrains Mono, monospace" font-size="11" fill="#7f8c8d">
            <text y="0">1. Allocate 0x2000 (size=4)</text>
            <text y="20">2. Copy A, B to new address</text>
            <text y="40">3. Release 0x1000 (size=2)</text>
        </g>
    </g>
    
    <!-- Final Pointer Connection -->
    <path d="M 320,215 C 360,215 410,350 460,350" fill="none" stroke="#ff9800" stroke-width="2.5" marker-end="url(#arrowhead-orange)" />
    <circle cx="320" cy="215" r="4" fill="#fbc02d" />
</svg>